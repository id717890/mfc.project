@{
    ViewBag.Title = "Администрирование";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section workmenu {
    @Html.Partial("_AdminMenu", 0)
}

<style type="text/css">
    .glyphicon-remove, .glyphicon-edit {
        cursor: pointer;
        font-size: 1.1em;
        text-decoration: none !important;
    }

    .glyphicon-remove {
        color: darkred;
    }
</style>

<h2>Список пользователей</h2>

<div ng-app="users.app">
    <div ng-controller="usersController" ng-cloak id="users-div">
        <a data-toggle="modal" data-target="#CreateUser" class="btn btn-primary">Добавить пользователя</a>
        <table class="table table-bordered table-striped table-hover table-condensed table-responsive">
            <thead>
                <tr>
                    <th hidden>Id</th>
                    <th>Имя пользователя</th>
                    <th>Описание</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="user in users">
                    <td hidden>{{user.id}}</td>
                    <td>{{user.user_name}}</td>
                    <td>{{user.description}}</td>
                    <td>
                        <a ng-click="editUser($index)" data-toggle="modal" data-target="#UpdateUser" class="glyphicon glyphicon-edit" title="Редактировать"></a>
                        <a ng-click="deleteUser($index)" class="glyphicon glyphicon-remove" title="Удалить пользователя"></a>
                        <a data-toggle="modal" data-target="#ChangePassword" class="glyphicon glyphicon-lock" title="Сменить пароль" ng-click="find_user($index)"></a>
                    </td>
                </tr>
            </tbody>
        </table>
        @Html.Partial("Edit")
        @Html.Partial("Create")

        <div>
            <!-- Modal for create user-->
            <div class="modal fade" id="ChangePassword" tabindex="-1" role="dialog"
                 aria-labelledby="ChangePasswordLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <form name="newPasswordForm" ng-submit="changePassword()" novalidate>
                                <div class="form-group" ng-class="{ 'has-error' : newPasswordForm.Password.$invalid && !newPasswordForm.Password.$pristine }">
                                    <input type="text" name="Password" class="form-control" ng-model="password.new_password" required placeholder="Логин пользователя">
                                    <p ng-show="newPasswordForm.Password.$invalid && !newPasswordForm.Password.$pristine" class="help-block">Укажите логин пользователя</p>
                                </div>
                                <div class="form-group" ng-class="{ 'has-error' : newPasswordForm.ConfirmPassword.$invalid && !newPasswordForm.ConfirmPassword.$pristine }">
                                    <input type="text" name="ConfirmPassword" class="form-control" ng-model="password.confirm_password" required placeholder="Логин пользователя">
                                    <p ng-show="newPasswordForm.ConfirmPassword.$invalid && !newPasswordForm.ConfirmPassword.$pristine" class="help-block">Укажите логин пользователя</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Отмена</button>
                                    <button type="submit" class="btn btn-success" ng-disabled="newPasswordForm.$invalid">Добавить</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</div>
@section javascripts{

    <script src="~/Content/js/angular/modules/users.app.js"></script>
    <script src="~/Content/js/angular/services/usersServices.js"></script>
    <script src="~/Content/js/angular/controllers/usersController.js"></script>

    <script src="~/Content/js/angular/services/passwordsService.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#CreateUser').on('hidden.bs.modal', function (e) {
                angular.element("#users-div").scope().clearForms();
            });
        })
    </script>
}
